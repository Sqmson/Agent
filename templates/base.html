<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='chatbot.png') }}" type="image/x-icon">
</head>
<body>
<div class="container">
    <div class="chatbox">
        <div class="chatbox__support">
            <div class="chatbox__header">
                <div class="chatbox__image--header">
                    <img src="{{ url_for('static', filename='images/chatbot.png') }}" alt="image">
                </div>
                <div class="chatbox__content--header">
                    <h4 class="chatbox__heading--header">Chat support</h4>
                </div>
            </div>
            <div class="chatbox__messages">
                <div class="empty-state">
                    <h3>Loading...</h3>
                    <p></p>
                </div>
            </div>
            <div class="chatbox__footer">
                <input type="text" placeholder="Write a message..." />
                <button class="chatbox__send--footer send__button">Send</button>
            </div>
        </div>
        <div class="chatbox__button">
            <button><img src="{{ url_for('static', filename='images/chatbox-icon.svg') }}" /></button>
        </div>
    </div>
</div>

<script type="text/javascript" src="{{ url_for('static', filename='app.js') }}"></script>
<script>
    window.addEventListener('load', async () => {
        try {
            const res = await fetch("/initial");
            const data = await res.json();

            const h3 = document.querySelector(".empty-state h3");
            const p = document.querySelector(".empty-state p");

            h3.textContent = "ðŸ¤– " + data.reply.split("\n")[0];
            p.textContent = data.reply.split("\n").slice(1).join(" ");

            if (data.suggestions) {
                const wrap = document.createElement("div");
                wrap.className = "suggestion-buttons";
                data.suggestions.forEach(item => {
                    const btn = document.createElement("button");
                    btn.textContent = item;
                    btn.onclick = () => {
                        const input = document.querySelector(".chatbox__footer input");
                        input.value = item;
                        document.querySelector(".send__button").click();
                    };
                    wrap.appendChild(btn);
                });
                document.querySelector(".empty-state").appendChild(wrap);
            }
        } catch (err) {
            console.error("Greeting fetch error:", err);
        }
    });
</script>
</body>
</html>
